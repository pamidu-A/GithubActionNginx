name: CI

on:
  - push

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2
      - name : secret file
        run : echo 'apiVersion: v1 \
kind: Secret \
metadata: \
  name: fdic-secret-production \
data:
  API_URL: aHR0cHM6Ly9mZGljLWFwaS5yZWFkeS1yb2JvdGljcy5jbG91ZC9hcGkvdjE=
  ACCESS_TOKEN_KEY: YWNjZXNzX3Rva2Vu
  FLASK_LOG_LEVEL: SU5GTw==
  SECRET_KEY: c2VjcmV0LWtleQ==
  MAINTENANCE_SERVER: cHNldWRvcmFtYS5ub3RyZWFkeS54eXo=
  MAINTENANCE_SERVER_USER: ZWMyLXVzZXI=
  PARAMETER_SERVER: aHR0cHM6Ly9wYXJhbWV0ZXJzLXNhbi5yZWFkeS54eXo=
  PARAMETER_SERVER_AUTH_TOKEN: ZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SjFjMlZ5WDJOc1lXbHRjeUk2ZXlKMWMyVnlibUZ0WlNJNkltRmxkSFZ5Ym5WdElpd2ljbTlzWlhNaU9sc2lkWE5sY2lJc0luSmxZV1JmWTNWemRHOXRaWEpmYzNSaGJtUmZaR1YwWVdsc2N5SXNJbkpsWVdSZmNtVmhaSGxmYzNSaGJtUmZaR1YwWVdsc2N5SmRmU3dpYW5ScElqb2lZek16Wm1aa056Y3ROamcyTWkwME1qQXdMV0UxTURZdFl6VXhaR00yTm1Nek1HUmpJaXdpWTNOeVppSTZJbVUyTnpkaFkySXpMVEF5TmpNdE5ERmxZeTFpT1dRM0xXVmhPR1psTmpjMVpEWTROU0lzSW1aeVpYTm9JanBtWVd4elpTd2lhV0YwSWpveE5UZ3lNakl3TVRjd0xDSjBlWEJsSWpvaVlXTmpaWE56SWl3aWJtSm1Jam94TlRneU1qSXdNVGN3TENKcFpHVnVkR2wwZVNJNkltRmxkSFZ5Ym5WdEluMC56YzRfanRkNDU1WDI4SFAyQnM3TDhSVUNxdUk0VE13cUF2bUJfUVhsU2VB
  SCREENSHOT_SYNC_PATH: L3RtcC9zY3JlZW5zaG90X3N5bmM=
  STORAGE_TYPE: cHlkcml2ZQ==
  STORAGE_PATH: L2JhY2t1cHM=
  DROPBOX_TOKEN: NVVxVE1ubm8wWEFBQUFBQUFBQUFGdk9JajU3dTV4V3lvSnktQUtZa2pVQktnbjlxS2M1b081R1dCbXVGeXFWMQ==
  PYDRIVE_TEAMDRIVE_ID: MEFPdmlib0lzYldrWlVrOVBWQQ==
  STORAGE_PATH: YmFja3Vwcw==
  DATABASE_USER: QWV0dXJudW0=
  DATABASE_PASSWORD: QWV0dXJudW1AOTkwMA==
  DATABASE_SERVER: MTAwLjEzMC4xNDQuMTY=
  DATABASE_NAME: ZmRpYw==
  WEB_PUSH_VAPID_PRIVATE_KEY: ZkVpZkxtS04yMFRKbEJpLTFUQ1MtM2xFalZxQnpnY1JHY3JaQU9xQ2RGVQ==
  WEB_PUSH_VAPID_PUBLIC_KEY: Qk5QbXpYMXFwYVdNOHJBWnlMeWVXaHFFdXNMYTB4cDRNYVdyLTB2eHZXUnY1VVVxbU9LREZpS0FYbG5XbWIybjhfQjFjRmhyQ09WQXBzMlVtY2N5MHZj
  JWT_ACCESS_TOKEN_EXPIRES: MTIwMDA=
  JWT_REFRESH_TOKEN_EXPIRES: NDMyMDA=
  LDAP_SERVER: bGRhcC5qdW1wY2xvdWQuY29t
  LDAP_BASE_DN: b3U9VXNlcnMsbz01YWVhMTVlZjJhN2U3YzBjZjFjMTZkMjcsZGM9anVtcGNsb3VkLGRjPWNvbQ==
  LDAP_BIND_USER: dWlkPWxkYXBfYmluZGVyLG91PVVzZXJzLG89NWFlYTE1ZWYyYTdlN2MwY2YxYzE2ZDI3LGRjPWp1bXBjbG91ZCxkYz1jb20=
  LDAP_BIND_PASSWORD: clk4QGckZGRHbmtld0h3V0dLNVM=
  NON_SENSITIVE_CUSTOMER_IDS: Miwz
  ASYNC_JOB_RETRY_COUNT: Mg==
  ASYNC_JOB_RETRY_DELAY: MTA=
  ASYNC_JOB_VISIBILITY_TIMEOUT: Mjg4MDA=
  POSTGRES_USER: QWV0dXJudW0=
  POSTGRES_PASSWORD: QWV0dXJudW1AOTkwMA==
  POSTGRES_DB : ZmRpYw==
  UPLOAD_TASK_TEMP_FOLDER: L3RtcC90YXNrcw==
  CELERY_RESULT_BACKEND : cmVkaXM6Ly8xMDAuMTMwLjE3Ny4xODc6NjM3OS8w
  CELERY_BROKER_URL : cmVkaXM6Ly8xMDAuMTMwLjE3Ny4xODc6NjM3OS8w
  SSH_KEY: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBb2d4eWYyaUI5Qk5NRk1kNDRMQnh4aVlNeWFhTDBRZlVHdkkveUIwcnhlRkVVSVRUeGtlWGJKZElWR29oCjNSSmZSSzlIS21Fdk1jSjhtNk84S01LNEJzWkFzZ05iVFlDdDI0Ni9nN283bW93U3ozMFRKQSs3WWM0WUlXTGVKdlRycWkvcUdVSUcKck9VWmdQZlRuLytSdmp5eGltNnQ3TnZxQVRIeWhYWFUzV2hjQjJVVFQxUEdaVi9xblQ3ZTFMekNXdXdPdnlFSVFkS2Jlcnhid0lieQp6NW9ZbXlmbjhHTzdpczhKRlIyejhzTGpCRXlJVHlKbk9XeFQrK08vblZ4TlBxcU56bUMxSERORTRkOHdwbWtUSjdSQlVPdkF0ZUpPCi9VY210NlF6eEVvVTlNaFIzQW9OMnRrd2tYU1FEWFZJN1l6WURLNlR3b2llcGxvdUU4Y2Qrd0lEQVFBQkFvSUJBRkRpZGFReXZlcmUKVnZOb1BXV3ByS0NERFk3NW1vQlRzQU5qTjRMalRKNFF1dENWL0Q3VUxUaitxaE80aGY2YTFRS3JtcElFd0ZIT0NmU0YzYjFhdEJCdApsSTFHTDZTWHZqQUJLSWJQeGtCMStrMm0ySTcvYTBCK1puMERwRzg5Z1FRSnRvZTA5VEFIaXB0ZEdEeWNqRnF3WU00QVFNQWhaTVFECjhsRzdadXk4QlB2bUlWNE9NWTBFTTJ3dXY4RldxcHVyQWtuV1lYd1BjZUp4R2F1T0o3SnBxaVN6d2JHSW5VL20zdDVuWFVBOERGYXQKT0lkMzhOaE50U3ZBczYxSHFvNk5xSmlCZWhhZHhXRzc1RE9ER0NaQXJ2QUVWZFh6c1VGQnJlUDlqUVMwV3lTMjI3cmhNamMxbmk4bQpiSkxCaGpJZFlmVTRQZWtaTDUvZFBIRWxBRUVDZ1lFQTYyOHdWRE9jbmlIMXlzNjQrcWpXWTFyOHVtRWh0RHp3eGxpSXUrZ245M2lqClBkelJ1Q0N2Sk5JYkxQNkVZT243QkJrckkvb0tJUkRxdFEvcjhOK0JIVDl0OURiRWYzejVwRnlwcTdrbUh4dDZvdStXcDdZL3piSVgKb2dPb2g0R2hHbjRxRkhHdHhScVg3emtDUm9LK2t2UXFYaFpTM0xUeVZ5aVRmYVl0TTJjQ2dZRUFzRFF5dzdWYlFOZS9oRW0zY2ZuRApsK1FuOFRqdHhiRzdtSVBvWnJZUVVtdnRUWFBKeFphbkF4Y1V5UE90bEpaREs3ZEhscUc0MjhsNjhRejZnUS9vWmhwNEZWRnBXaThJCjB5eGNHZStsWjh3cjdnTEZMbFJraDhRZWp2MGt6RHdqWUZFSnk1VVZIMjFkVXRhUVB6UFVnUnI2QkIyWWUyRE1mY05yYitTYkdFMEMKZ1lFQXlVbm5LQlo0Y1RyWHl1MnplWnVnc0pHNlFoK0prWEFJNjR3R1c2SEJpZk82bmNtT0JMN3MvNjRqVGZUTmVZNlM3bzRXTkV3egpITkk1MlZRamhXMlNGaytFMHFlQW1QOWc4UVhJaXVsaGpuY1FBdjZVOEE4QnZmdmwrTDduOS9MOHFvbnpzRWNCS3VQeHdyWWJHKzNzCndmZS93WEdVcHQ2TjA3YjlZeEFRMVVFQ2dZQVlSb2k3NTg5enBvV3ZMd3pEK2hvVllneVNzam9uNDIycC9IcFhORHdaYnQ4WnJac2QKeXJ5bHMxZGN2QjJzKytxektpUUZ2N0FkTDZ2dGE5RlRXS0syOW15VzIwbDljRDl5QUltTDFUVmZrSVI0M1E3WGJDOFJlVmFRY3BYUQpRWFRLUHovdk9WSFlxNU9RNXhpbWJIaVpkT0wvRUNqQ3pybzlsVi9HNGFMd2ZRS0JnUUM1SXNuM0YxTTJ5SW9MN3VsMEx6M2V6S2RjCkQ1SmdOOENXTkJkYUt1Z0o4WjlLTmFlVXo2YnNOYk9oZTVzWU1VNWVSWm9uM2ptUDRxQ09ZRStmYkdWdVY1c0trdk9DakRtdlBjYnoKVW8vRk1lYkdLUUdrV3MyTE83MUVzZ2w1cGd1NzZmT1ZKQmJzNXJTMmJqSTBuWWNPVC9oV2hZbWJoZTd2MCtoeHZJNmtGQT09Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0
  GDRIVE_KEY: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicHlkcml2ZS0yNzkyMDciLAogICJwcml2YXRlX2tleV9pZCI6ICIyMmNiMGE4MjE3MDY1N2U3ZmVkZjhiZmI4MDc0ZDhiYzU1MjVjZTYzIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURDZzBDY0RBNWIzMjRyXG5sVmMxdGpsclBlK0hjSmlEVk5IcTl4Ym9SaUhQai9BTUtDeDI1MWVieVZ2NTE3amZ5aW9KTEp4MHdySXdOOXlTXG4xM24rblNWbmh5WGV6TWpVSkcwWVpSUFBuUWtJQmMxY3Bob05DU2Vya3J0eGdYVXhsRk9vSk9ySzVvb21pdjJwXG5iakQzN1MvUXR1eno2UDdnQzAraklmajhiU0JRR0NPd2c5Vld0UGliMFM1cTdGV1VNaVowZHVYempIMzI4MjRuXG5aNDV3OEtZTFZ1aVI1VXROY0tRUkRKYWR4amFmRmZ5UEN2bE84M1ZKWXRIU04wWGtJVFVTYXhXekxET1BJTXhPXG5veS9lUFJGcG1HMjFrMDdIY3poekFjUWZMUWdZQ0dVcU5hSTF3RkR3YmZ1blpBNVNtaHZrOUFRdEpTRWkwWFQ4XG55YVVDVTlNREFnTUJBQUVDZ2dFQUlyQTBpLytzYWQ3NUwwV1ZSV3RuWndRbkhPRE1HaE84MGVuWnlIZUZYUlkrXG55WFE2cGNQUkFHUFRCc1hkWHUrWE9vYWRxa2IwYnh2dk5ySzl1MVg4RHkvdlpZSGd5TkJzTWo4SVh1eVM2VDdiXG5wa3VxOXFzc3kzRENBOWFCOTJNTDNqOGpMaWNaK1JDdGR4TkRJVnZIdkxGNnBXN21VVDlESndVT2VibmVXdG43XG5nY00yOWpWTzZHcnhZYTlIdzFmWkNVeDdFQlBPUk5tcHlhT1o4SXJNTG5TaFRNSlhjelFRRWVMakZLT1NTTWI2XG4wajBtRVhpdXlHRHoxa2pINGw2Z3Zhend5dmdQVUZ6ek5SL3VqN25hRkNpQ0VFNXljTUcxMzZQTStLV2U0L1hZXG5JbFhITUkrYXgyTTluTVVkT2NjMGh3VzlwR0dyaVRTMXFJa05HelhEdlFLQmdRRHJwVktzcGdGdUJDQS9ZSyt6XG43UTZndXlLanVRcm1pMkxBQThDV09GbDhmT1hITmwrSXVqYm1zbUpMcnpZNGtmYzlsajJwNkRDVDlkT1FvWlJyXG5JWjRXaEQ0NFljSjh2RjZaNEJOdTIyMUxuR0h3KytXM3gzVnBMa2ZxUW5KNG02VkoyRVRrK1J3UHBvOWM1OFV3XG44ZXlHMU9MZ0tSZWdvM2pNNE9zcy9zQ3Vmd0tCZ1FEVFVHR1BzYnhnZ3JCUVd3T3BOUHduTEZobXk2cEt3Tys5XG5UUTEvMHZEaTJIaEJIdEFzWnV6Sk1CN2w0NnhJWW9uMmNEWCtERnZudGNLR3prdjFiS0NaY0k2eXd0S2pTVzFpXG5XRDBTL2tTN1l0dDQ2RHY0UDRVYk1LdFdYVDg0UGRNczF0SkZRejA1TEdNQm55MFl5SEFHckNoNXU4TjRGdEQzXG5TUmg5SEovaGZRS0JnSHZGbDFvMXk3UjBtRmVSdWxnZ1lMbU44WkRiWmQxWVF5TW1GV2NSNi9iV1IzN09rWGxvXG5qZU80dUthV1BqMlNkYkcwazJrR0cxWHNIaGJ1dDkxWmlBYTlxVXpHRkhpZUhIWm9XdXkwZG9EcmdBb3ExU3NsXG5xZ2I0RnkvMWZOamFzQVBNZzh0ZENSOHpWa1B2UFFVTFhUZ280NDNvSjQvcHJVNjNxTzgyVkJDVEFvR0JBSU1WXG5JOUFOZ3p1akZsaGlmUnpqdjE5VmhPa1BnZTJwVFk1eVUrTnRLUHl2SjduTnNYazV4N3p0MnR6a3BLU3FhOGF4XG55T3gxSWpYVWJIMVBUNU5JOVQ3NXNhdDJhMC9iWnIxUTIySUMxUVFneU9CeHYzRzVoWXBlWUlyTWdVRVVLUUZ4XG5xVEpLQ1pxRHpFN2ZQUXhZbWhXcGlkb3AvWkZySmVtZ01FNjhDUG5KQW9HQU1KNE5yS3g4cURjVTNPQUtLZDdhXG5YcE1lRWRmdzFxVllpSE8yVmFBSS90SmVSWnQ0SVVoVGFqTmlLNFQwZTNXMU1aWFdPZ2xCaWVjMEJ4SU02SE9NXG5GRlBqSnoxcVRxR2tRVXJueG8rL3JiQTc1b0ZtWlJJVUdZU0dhckhHczYwcjFMV1N2NUZSTlhpZDliaU1JMHhHXG42Vy9GMjc0b1JvTDBzWkUraElkaGg3QT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJ0ZXN0Mi04MzRAcHlkcml2ZS0yNzkyMDcuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTAyODM1NjA5NjU2Mzg4MDc2Mjk1IiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS90ZXN0Mi04MzQlNDBweWRyaXZlLTI3OTIwNy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=
 >> secret.yaml
      - name : read secret
        run : cat secret.yaml

      - name: Trigger deploy
        uses: Consensys/kubernetes-action@master
        env:
          KUBE_CONFIG_DATA: ${{ secrets.KUBE_CONFIG_DATA }}
        with:
          args: apply -f deployment.yaml -n githubaction
